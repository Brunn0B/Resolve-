<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Inteligente de Suporte</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #082945;
            --primary-light: #e6f0ff;
            --secondary: #0a4b8c;
            --accent: #3a86ff;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --dark-gray: #343a40;
            --light-gray: #e9ecef;
            --white: #ffffff;
            --black: #212529;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background-color: var(--white);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            position: fixed;
            height: 100vh;
            transition: var(--transition);
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: var(--border-radius);
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--primary);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1.25rem;
            border-radius: var(--border-radius);
            color: var(--dark-gray);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-link:hover {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .nav-link.active {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-link i {
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
        }

        .content {
            flex-grow: 1;
            margin-left: 280px;
            padding: 2rem;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .page-title {
            font-size: 1.75rem;
            color: var(--primary);
            font-weight: 700;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .chat-container {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            height: calc(100vh - 150px);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background-color: var(--primary);
            color: var(--white);
            padding: 1.25rem 1.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .chat-title i {
            font-size: 1.3rem;
        }

        .chat-actions {
            display: flex;
            gap: 1.25rem;
        }

        .chat-action {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
            padding: 0.25rem;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-action:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .chat-body {
            flex-grow: 1;
            padding: 1.75rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: #fafbff;
        }

        .welcome-message {
            text-align: center;
            margin: auto;
            max-width: 600px;
            padding: 2rem;
        }

        .welcome-message h2 {
            color: var(--primary);
            margin-bottom: 1.25rem;
            font-size: 1.8rem;
        }

        .welcome-message p {
            color: var(--gray);
            margin-bottom: 2rem;
            font-size: 1.05rem;
            line-height: 1.7;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1.25rem;
            margin-top: 2.5rem;
        }

        .quick-action {
            background-color: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            padding: 1.25rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .quick-action:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .quick-action i {
            font-size: 1.75rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .quick-action span {
            font-size: 0.95rem;
            color: var(--dark-gray);
            font-weight: 500;
        }

        .chat-messages {
            flex-grow: 1;
            margin-bottom: 1rem;
            display: none;
        }

        .message {
            margin-bottom: 1.5rem;
            max-width: 85%;
            padding: 1rem 1.25rem;
            border-radius: var(--border-radius);
            position: relative;
            word-wrap: break-word;
            animation: fadeIn 0.4s ease;
            line-height: 1.5;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background-color: var(--primary);
            color: var(--white);
            margin-left: auto;
            border-bottom-right-radius: 0;
            box-shadow: 0 2px 8px rgba(8, 41, 69, 0.2);
        }

        .bot-message {
            background-color: var(--white);
            border: 1px solid var(--light-gray);
            margin-right: auto;
            border-bottom-left-radius: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bot-message .message-sender {
            color: var(--primary);
        }

        .user-message .message-sender {
            color: rgba(255, 255, 255, 0.9);
        }

        .message-time {
            font-size: 0.75rem;
            text-align: right;
            margin-top: 0.5rem;
            opacity: 0.8;
        }

        .message-solutions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed var(--light-gray);
        }

        .solution-buttons {
            display: flex;
            gap: 0.75rem;
            margin: 0.75rem 0;
            flex-wrap: wrap;
        }

        .solution-buttons button {
            background: var(--primary-light);
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .solution-buttons button:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .message-meta {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .message-meta i {
            font-size: 0.9rem;
        }

        .chat-input-container {
            padding: 1.25rem 1.75rem;
            border-top: 1px solid var(--light-gray);
            background-color: var(--white);
        }

        .chat-input {
            display: flex;
            gap: 1rem;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 0.9rem 1.25rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            outline: none;
            transition: var(--transition);
            font-size: 1rem;
        }

        .chat-input input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(8, 41, 69, 0.2);
        }

        .chat-input button {
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius);
            padding: 0 1.75rem;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-input button:hover {
            background-color: var(--secondary);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--white);
            border-radius: 20px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--light-gray);
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: var(--gray);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        /* Efeito de skeleton loading */
        .skeleton {
            animation: skeleton-loading 1.5s infinite ease-in-out;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 4px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Modal de confirmação */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.25rem 1.75rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 1.75rem;
        }

        .modal-footer {
            padding: 1.25rem 1.75rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .modal-btn {
            padding: 0.6rem 1.25rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn-primary {
            background-color: var(--primary);
            color: var(--white);
            border: none;
        }

        .modal-btn-primary:hover {
            background-color: var(--secondary);
        }

        .modal-btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark);
            border: none;
        }

        .modal-btn-secondary:hover {
            background-color: var(--gray);
            color: var(--white);
        }

        /* Upload de arquivos */
        .file-upload {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .file-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 2px dashed var(--gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload-label:hover {
            border-color: var(--primary);
        }

        .file-upload-label i {
            font-size: 2.5rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .file-upload-label span {
            color: var(--gray);
            text-align: center;
        }

        .file-upload-input {
            display: none;
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .file-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .file-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-remove {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background-color: var(--danger);
            color: var(--white);
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            opacity: 0.8;
            transition: var(--transition);
        }

        .file-preview-remove:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Formulários */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(8, 41, 69, 0.2);
            outline: none;
        }

        .form-text {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .form-check-input {
            width: 1.1rem;
            height: 1.1rem;
        }

        .form-check-label {
            font-size: 0.95rem;
            color: var(--dark-gray);
        }

        /* Alertas */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .alert i {
            font-size: 1.25rem;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.2);
            color: var(--success);
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            color: var(--warning);
        }

        .alert-danger {
            background-color: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.2);
            color: var(--danger);
        }

        .alert-info {
            background-color: rgba(23, 162, 184, 0.1);
            border: 1px solid rgba(23, 162, 184, 0.2);
            color: var(--secondary);
        }

        /* Tabelas */
        .table-container {
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--white);
        }

        .table th, .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .table th {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        .table tr:hover {
            background-color: rgba(8, 41, 69, 0.03);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .table-btn {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .table-btn-view {
            background-color: rgba(8, 41, 69, 0.1);
            color: var(--primary);
        }

        .table-btn-view:hover {
            background-color: rgba(8, 41, 69, 0.2);
        }

        .table-btn-edit {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .table-btn-edit:hover {
            background-color: rgba(255, 193, 7, 0.2);
        }

        .table-btn-delete {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .table-btn-delete:hover {
            background-color: rgba(220, 53, 69, 0.2);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .badge-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        /* Cards */
        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card-header {
            padding: 1.25rem 1.75rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }

        .card-body {
            padding: 1.75rem;
        }

        .card-footer {
            padding: 1.25rem 1.75rem;
            border-top: 1px solid var(--light-gray);
            background-color: var(--light-gray);
        }

        /* Progress bars */
        .progress {
            height: 0.5rem;
            background-color: var(--light-gray);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 0.25rem;
            transition: width 0.6s ease;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
            
            .content {
                margin-left: 250px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
                padding: 1rem 0.5rem;
            }
            
            .logo span, .nav-link span {
                display: none;
            }
            
            .logo {
                justify-content: center;
                padding: 0.5rem;
            }
            
            .nav-link {
                justify-content: center;
                padding: 0.8rem 0;
            }
            
            .content {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
            }
            
            .logo span {
                display: inline;
            }
            
            .nav-menu {
                display: flex;
                gap: 0.5rem;
            }
            
            .nav-item {
                margin-bottom: 0;
            }
            
            .nav-link span {
                display: none;
            }
            
            .content {
                margin-left: 0;
                padding: 1.5rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .chat-container {
                height: calc(100vh - 200px);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .content {
                padding: 1.25rem;
            }
            
            .chat-body {
                padding: 1.25rem;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .message {
                max-width: 90%;
                padding: 0.9rem 1.1rem;
            }
            
            .chat-input-container {
                padding: 1rem;
            }
            
            .chat-input input {
                padding: 0.8rem 1rem;
            }
            
            .chat-input button {
                padding: 0 1.25rem;
            }
        }
        
        @media (max-width: 480px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                display: flex;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            
            .logo {
                justify-content: center;
                margin-bottom: 1rem;
            }
            
            .nav-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .nav-item {
                margin-bottom: 0;
            }
            
            .nav-link {
                padding: 0.5rem;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                justify-content: center;
            }
            
            .nav-link span {
                display: none;
            }
            
            .nav-link i {
                margin: 0;
            }
            
            .content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }
            
            .user-profile {
                width: 100%;
                justify-content: flex-end;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .chat-container {
                height: calc(100vh - 180px);
            }
            
            .chat-header {
                padding: 0.75rem 1rem;
            }
            
            .chat-title span {
                font-size: 1rem;
            }
            
            .chat-body {
                padding: 1rem;
            }
            
            .welcome-message {
                padding: 1rem;
            }
            
            .welcome-message h2 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .quick-actions {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                margin-top: 1.5rem;
            }
            
            .quick-action {
                padding: 1rem 0.5rem;
            }
            
            .quick-action i {
                font-size: 1.5rem;
            }
            
            .message {
                max-width: 95%;
                padding: 0.8rem 1rem;
                font-size: 0.95rem;
            }
            
            .chat-input-container {
                padding: 0.75rem;
            }
            
            .chat-input {
                gap: 0.5rem;
            }
            
            .chat-input input {
                padding: 0.75rem 1rem;
            }
            
            .chat-input button {
                padding: 0 1rem;
            }
            
            .send-text {
                display: none;
            }
            
            .typing-indicator {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            
            .typing-indicator span:last-child {
                display: none;
            }
        }

        @media (max-width: 360px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .chat-container {
                height: calc(100vh - 160px);
            }
            
            .chat-input input {
                padding: 0.6rem 0.8rem;
            }
            
            .chat-input button {
                padding: 0 0.8rem;
            }
        }

        @media (max-height: 480px) and (orientation: landscape) {
            .sidebar {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .nav-menu {
                margin-top: 0;
            }
            
            .chat-container {
                height: calc(100vh - 120px);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <aside class="sidebar">
            <a href="PerfilUser.html" class="logo">
                <i class="fas fa-user"></i>
                <span>Perfil</span>
            </a>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="TelaChamados.html" class="nav-link active">
                        <i class="fas fa-chart-pie"></i>
                        <span>Deshboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="Mensalidade.html" class="nav-link">
                        <i class="fas fa-ticket-alt"></i>
                        <span>serviços</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="abrir-chamado.html" class="nav-link">
                        <i class="fas fa-ticket-alt"></i>
                        <span>Abrir Chamado</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-user-shield"></i>
                        <span>Admin</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="content">
            <div class="header">
                <h1 class="page-title">Assistente Virtual de Suporte</h1>
                <div class="user-profile">
                    <span>Olá, Usuário</span>
                    <img src="https://ui-avatars.com/api/?name=Usuario&background=082945&color=fff" alt="Avatar" class="user-avatar">
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">
                        <i class="fas fa-headset"></i>
                        <span>Suporte com IA</span>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action" title="Limpar conversa" id="clearChat">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button class="chat-action" title="Histórico" id="showHistory">
                            <i class="fas fa-history"></i>
                        </button>
                        <button class="chat-action" title="Ajuda" id="showHelp">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>
                
                <div class="chat-body">
                    <div class="welcome-message" id="welcomeMessage">
                        <h2>Como posso te ajudar hoje?</h2>
                        <p>Nosso assistente virtual está pronto para responder suas dúvidas, ajudar com problemas técnicos ou guiá-lo em nossos serviços.</p>
                        
                        <div class="quick-actions">
                            <div class="quick-action" onclick="sendQuickMessage('Como resetar minha senha?')">
                                <i class="fas fa-key"></i>
                                <span>Resetar Senha</span>
                            </div>
                            <div class="quick-action" onclick="sendQuickMessage('Meu sistema está lento')">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Sistema Lento</span>
                            </div>
                            <div class="quick-action" onclick="sendQuickMessage('Como criar um novo usuário?')">
                                <i class="fas fa-user-plus"></i>
                                <span>Novo Usuário</span>
                            </div>
                            <div class="quick-action" onclick="sendQuickMessage('Relatar um problema técnico')">
                                <i class="fas fa-bug"></i>
                                <span>Problema Técnico</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages"></div>
                    
                    <div class="typing-indicator" id="typingIndicator">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span>Assistente está digitando...</span>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Digite sua mensagem..." autocomplete="off">
                        <button id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                            <span class="send-text">Enviar</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de confirmação -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Confirmar ação</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Tem certeza que deseja limpar toda a conversa? Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancelAction">Cancelar</button>
                <button class="modal-btn modal-btn-primary" id="confirmAction">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de histórico -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Histórico de Conversas</h3>
                <button class="modal-close" id="closeHistoryModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Assunto</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeHistoryModalBtn">Fechar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ajuda do Assistente</h3>
                <button class="modal-close" id="closeHelpModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <h4>Como usar o assistente</h4>
                        <p>Nosso assistente virtual pode te ajudar com diversos tipos de solicitações:</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Comandos disponíveis</h4>
                    </div>
                    <div class="card-body">
                        <ul style="list-style-type: none; padding-left: 0;">
                            <li style="margin-bottom: 1rem;">
                                <strong><i class="fas fa-key"></i> Redefinir senha</strong>
                                <p>Digite "esqueci minha senha" ou "preciso redefinir minha senha"</p>
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong><i class="fas fa-ticket-alt"></i> Abrir chamado</strong>
                                <p>Digite "preciso abrir um chamado" ou "reportar problema"</p>
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong><i class="fas fa-user"></i> Atualizar perfil</strong>
                                <p>Digite "atualizar meus dados" ou "mudar informações"</p>
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong><i class="fas fa-question"></i> Dúvidas gerais</strong>
                                <p>Digite sua pergunta normalmente que tentaremos ajudar</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="closeHelpModalBtn">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de upload -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Enviar Arquivo</h3>
                <button class="modal-close" id="closeUploadModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-upload">
                    <label for="fileInput" class="file-upload-label" id="fileUploadLabel">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Arraste e solte seu arquivo aqui ou clique para selecionar</span>
                        <input type="file" id="fileInput" class="file-upload-input" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                    </label>
                    <div class="file-preview" id="filePreview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancelUpload">Cancelar</button>
                <button class="modal-btn modal-btn-primary" id="confirmUpload" disabled>Enviar</button>
            </div>
        </div>
    </div>

<script>
    // Sistema de Memória e Aprendizado Avançado
    class ChatbotMemory {
        constructor() {
            this.memory = JSON.parse(localStorage.getItem('chatbotMemory')) || {
                userProfile: {
                    name: 'Usuário',
                    email: '',
                    preferences: {},
                    lastSession: null,
                    usageCount: 0,
                    isAdmin: false
                },
                conversationHistory: [],
                learnedPatterns: {},
                knowledgeBase: {
                    passwordReset: {},
                    profileUpdates: {},
                    commonIssues: {},
                    ticketManagement: {}
                },
                context: {},
                tickets: [],
                settings: {
                    theme: 'light',
                    notifications: true,
                    sound: true
                }
            };
        }

        save() {
            localStorage.setItem('chatbotMemory', JSON.stringify(this.memory));
        }

        addInteraction(userMessage, botResponse, context = {}) {
            this.memory.conversationHistory.push({
                user: userMessage,
                bot: botResponse,
                timestamp: new Date().toISOString(),
                context
            });
            
            if (this.memory.conversationHistory.length > 100) {
                this.memory.conversationHistory = this.memory.conversationHistory.slice(-100);
            }
            this.save();
        }

        learnPattern(inputPattern, response) {
            const patternKey = inputPattern.toLowerCase().substring(0, 50);
            this.memory.learnedPatterns[patternKey] = response;
            this.save();
        }

        getLearnedResponse(input) {
            const inputKey = input.toLowerCase().substring(0, 50);
            return this.memory.learnedPatterns[inputKey];
        }

        updateUserProfile(data) {
            this.memory.userProfile = {...this.memory.userProfile, ...data};
            this.save();
        }

        getContext() {
            return this.memory.context;
        }

        setContext(newContext) {
            this.memory.context = {...this.memory.context, ...newContext};
            this.save();
        }

        clearContext() {
            this.memory.context = {};
            this.save();
        }

        addTicket(ticket) {
            this.memory.tickets.push({
                ...ticket,
                id: Date.now().toString(),
                status: 'open',
                createdAt: new Date().toISOString()
            });
            this.save();
        }

        updateTicket(ticketId, updates) {
            const ticketIndex = this.memory.tickets.findIndex(t => t.id === ticketId);
            if (ticketIndex !== -1) {
                this.memory.tickets[ticketIndex] = {
                    ...this.memory.tickets[ticketIndex],
                    ...updates
                };
                this.save();
            }
        }

        getTickets() {
            return [...this.memory.tickets].reverse();
        }

        clearConversation() {
            this.memory.conversationHistory = [];
            this.save();
        }

        updateSettings(newSettings) {
            this.memory.settings = {...this.memory.settings, ...newSettings};
            this.save();
        }

        getSettings() {
            return this.memory.settings;
        }
    }

    // Sistema de Fluxos de Conversação
    class ConversationFlow {
        static FLOWS = {
            PASSWORD_RESET: {
                id: 'password_reset',
                steps: [
                    {
                        prompt: "Para redefinir sua senha, por favor digite o e-mail associado à sua conta:",
                        validate: (input) => {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            return emailRegex.test(input) ? null : "Por favor, insira um e-mail válido.";
                        },
                        handler: (input, context) => {
                            context.email = input;
                            return {
                                nextStep: 1,
                                response: `Ótimo, encontramos sua conta (${input}). Agora, por favor, digite sua nova senha:`,
                                actions: [
                                    {type: "log", message: "Usuário forneceu email para redefinição de senha"}
                                ]
                            };
                        }
                    },
                    {
                        prompt: "Agora, por favor, digite sua nova senha:",
                        validate: (input) => {
                            if (input.length < 8) return "A senha deve ter pelo menos 8 caracteres.";
                            if (!/\d/.test(input)) return "A senha deve conter pelo menos um número.";
                            if (!/[A-Z]/.test(input)) return "A senha deve conter pelo menos uma letra maiúscula.";
                            if (!/[!@#$%^&*(),.?":{}|<>]/.test(input)) return "A senha deve conter pelo menos um caractere especial.";
                            return null;
                        },
                        handler: (input, context) => {
                            context.newPassword = input;
                            return {
                                nextStep: 2,
                                response: "Por favor, confirme sua nova senha:",
                                actions: [
                                    {type: "log", message: "Usuário criou nova senha"}
                                ]
                            };
                        }
                    },
                    {
                        prompt: "Por favor, confirme sua nova senha:",
                        validate: (input, context) => {
                            return input === context.newPassword ? null : "As senhas não coincidem. Por favor, tente novamente.";
                        },
                        handler: (input, context) => {
                            return {
                                nextStep: null,
                                response: "Sua senha foi atualizada com sucesso!",
                                actions: [
                                    {type: "navigate", url: "/PerfilUser.html", label: "Ir para Meu Perfil"},
                                    {type: "learn", key: "password_reset", value: "completed"},
                                    {type: "log", message: "Senha redefinida com sucesso"}
                                ]
                            };
                        }
                    }
                ]
            },
            TICKET_CREATION: {
                id: 'ticket_creation',
                steps: [
                    {
                        prompt: "Vamos criar um novo chamado. Por favor, descreva brevemente o problema:",
                        validate: (input) => {
                            return input.length > 10 ? null : "Por favor, forneça uma descrição mais detalhada (mínimo 10 caracteres).";
                        },
                        handler: (input, context) => {
                            context.description = input;
                            return {
                                nextStep: 1,
                                response: "Ótimo. Agora, qual é a prioridade deste chamado? (baixa, média, alta, urgente)",
                                actions: [
                                    {type: "log", message: "Usuário iniciou criação de chamado"}
                                ]
                            };
                        }
                    },
                    {
                        prompt: "Qual é a prioridade deste chamado? (baixa, média, alta, urgente)",
                        validate: (input) => {
                            const validPriorities = ['baixa', 'média', 'alta', 'urgente'];
                            return validPriorities.includes(input.toLowerCase()) ? null : "Por favor, escolha entre: baixa, média, alta ou urgente.";
                        },
                        handler: (input, context) => {
                            context.priority = input.toLowerCase();
                            return {
                                nextStep: 2,
                                response: "Você gostaria de anexar alguma imagem ou arquivo para nos ajudar a entender melhor o problema? (sim/não)",
                                actions: [
                                    {type: "log", message: "Usuário definiu prioridade do chamado"}
                                ]
                            };
                        }
                    },
                    {
                        prompt: "Você gostaria de anexar alguma imagem ou arquivo? (sim/não)",
                        validate: (input) => {
                            const normalized = input.toLowerCase();
                            return normalized === 'sim' || normalized === 's' || normalized === 'não' || normalized === 'nao' || normalized === 'n' ? 
                                null : "Por favor, responda com 'sim' ou 'não'.";
                        },
                        handler: (input, context) => {
                            const wantsUpload = input.toLowerCase() === 'sim' || input.toLowerCase() === 's';
                            if (wantsUpload) {
                                return {
                                    nextStep: 3,
                                    response: "Por favor, clique no ícone de anexo para enviar seu arquivo.",
                                    actions: [
                                        {type: "showUpload", label: "Anexar Arquivo"},
                                        {type: "log", message: "Usuário optou por anexar arquivo"}
                                    ]
                                };
                            } else {
                                return this.completeTicketCreation(context);
                            }
                        }
                    },
                    {
                        prompt: "Aguardando upload do arquivo...",
                        validate: (input, context) => {
                            return context.file ? null : "Por favor, anexe um arquivo ou digite 'cancelar' para continuar sem anexo.";
                        },
                        handler: (input, context) => {
                            return this.completeTicketCreation(context);
                        }
                    }
                ],
                complete: function(context) {
                    const ticket = {
                        id: Date.now().toString(),
                        description: context.description,
                        priority: context.priority,
                        status: 'open',
                        createdAt: new Date().toISOString(),
                        file: context.file || null
                    };
                    
                    return {
                        nextStep: null,
                        response: `Chamado #${ticket.id} criado com sucesso! Nossa equipe entrará em contato em breve.`,
                        actions: [
                            {type: "createTicket", ticket: ticket},
                            {type: "learn", key: "ticket_creation", value: "completed"},
                            {type: "log", message: "Chamado criado com sucesso"}
                        ]
                    };
                }
            },
            PROFILE_UPDATE: {
                id: 'profile_update',
                steps: [
                    {
                        prompt: "Vamos atualizar seu perfil. Qual informação você gostaria de alterar? (nome, email, telefone, departamento, bio)",
                        validate: (input) => {
                            const validFields = ['nome', 'email', 'telefone', 'departamento', 'bio'];
                            return validFields.includes(input.toLowerCase()) ? null : "Por favor, escolha entre: nome, email, telefone, departamento ou bio.";
                        },
                        handler: (input, context) => {
                            context.field = input.toLowerCase();
                            let prompt = "";
                            switch(context.field) {
                                case 'nome':
                                    prompt = "Por favor, digite seu novo nome completo:";
                                    break;
                                case 'email':
                                    prompt = "Por favor, digite seu novo e-mail:";
                                    break;
                                case 'telefone':
                                    prompt = "Por favor, digite seu novo telefone (com DDD):";
                                    break;
                                case 'departamento':
                                    prompt = "Por favor, digite seu novo departamento:";
                                    break;
                                case 'bio':
                                    prompt = "Por favor, digite sua nova biografia:";
                                    break;
                            }
                            return {
                                nextStep: 1,
                                response: prompt,
                                actions: [
                                    {type: "log", message: `Usuário iniciou atualização de ${context.field}`}
                                ]
                            };
                        }
                    },
                    {
                        prompt: "",
                        validate: (input, context) => {
                            if (context.field === 'email') {
                                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                                return emailRegex.test(input) ? null : "Por favor, insira um e-mail válido.";
                            }
                            return input.length > 0 ? null : "Este campo não pode estar vazio.";
                        },
                        handler: (input, context) => {
                            context.newValue = input;
                            return {
                                nextStep: null,
                                response: `Seu ${context.field} foi atualizado com sucesso!`,
                                actions: [
                                    {type: "updateProfile", field: context.field, value: context.newValue},
                                    {type: "learn", key: "profile_update", value: "completed"},
                                    {type: "log", message: `Usuário atualizou ${context.field}`},
                                    {type: "navigate", url: "/PerfilUser.html", label: "Ver Perfil"}
                                ]
                            };
                        }
                    }
                ]
            },
            ADMIN_REPORT: {
                id: 'admin_report',
                steps: [
                    {
                        prompt: "Você está acessando o painel administrativo. Qual relatório deseja gerar? (usuários, chamados, atividades)",
                        validate: (input) => {
                            const validReports = ['usuários', 'chamados', 'atividades'];
                            return validReports.includes(input.toLowerCase()) ? null : "Por favor, escolha entre: usuários, chamados ou atividades.";
                        },
                        handler: (input, context) => {
                            context.reportType = input.toLowerCase();
                            return {
                                nextStep: 1,
                                response: `Gerando relatório de ${context.reportType}...`,
                                actions: [
                                    {type: "generateReport", reportType: context.reportType},
                                    {type: "log", message: `Admin solicitou relatório de ${context.reportType}`}
                                ]
                            };
                        }
                    }
                ]
            }
        };

        constructor(memorySystem) {
            this.memory = memorySystem;
            this.currentFlow = null;
            this.currentStep = null;
        }

        startFlow(flowId) {
            this.currentFlow = ConversationFlow.FLOWS[flowId];
            this.currentStep = 0;
            this.memory.setContext({flow: flowId, step: 0});
            return this.currentFlow.steps[0].prompt;
        }

        processInput(input) {
            if (!this.currentFlow || this.currentStep === null) return null;
            
            const step = this.currentFlow.steps[this.currentStep];
            const validationError = step.validate(input, this.memory.getContext());
            
            if (validationError) {
                return {error: validationError};
            }
            
            let result;
            if (this.currentFlow.id === 'ticket_creation' && this.currentStep === 3) {
                result = this.currentFlow.complete(this.memory.getContext());
            } else {
                result = step.handler(input, this.memory.getContext());
            }
            
            if (result.nextStep !== null) {
                this.currentStep = result.nextStep;
                this.memory.setContext({step: this.currentStep});
            } else {
                this.completeFlow(result.actions);
            }
            
            return result;
        }

        completeFlow(actions = []) {
            actions.forEach(action => {
                switch(action.type) {
                    case "navigate":
                        window.navigateTo(action.url, action.label);
                        break;
                    case "learn":
                        this.memory.learnPattern(action.key, action.value);
                        break;
                    case "createTicket":
                        this.memory.addTicket(action.ticket);
                        break;
                    case "updateProfile":
                        const update = {[action.field]: action.value};
                        this.memory.updateUserProfile(update);
                        break;
                    case "generateReport":
                        this.generateReport(action.reportType);
                        break;
                    case "showUpload":
                        document.getElementById('uploadModal').classList.add('active');
                        break;
                    case "log":
                        console.log(action.message);
                        break;
                }
            });
            
            this.currentFlow = null;
            this.currentStep = null;
            this.memory.clearContext();
        }

        generateReport(reportType) {
            let reportData;
            switch(reportType) {
                case 'usuários':
                    reportData = {
                        total: 42,
                        active: 38,
                        admins: 3
                    };
                    break;
                case 'chamados':
                    const tickets = this.memory.getTickets();
                    reportData = {
                        total: tickets.length,
                        open: tickets.filter(t => t.status === 'open').length,
                        closed: tickets.filter(t => t.status === 'closed').length
                    };
                    break;
                case 'atividades':
                    reportData = {
                        logins: 127,
                        tickets: 19,
                        updates: 8
                    };
                    break;
            }
            
            return reportData;
        }
    }

    class IntelligentChatbot {
        constructor() {
            this.memory = new ChatbotMemory();
            this.flowSystem = new ConversationFlow(this.memory);
            this.isProcessing = false;
            
            this.chatInput = document.getElementById('chatInput');
            this.sendButton = document.getElementById('sendButton');
            this.chatMessages = document.getElementById('chatMessages');
            this.welcomeMessage = document.getElementById('welcomeMessage');
            this.typingIndicator = document.getElementById('typingIndicator');
            

            this.confirmModal = document.getElementById('confirmModal');
            this.historyModal = document.getElementById('historyModal');
            this.helpModal = document.getElementById('helpModal');
            this.uploadModal = document.getElementById('uploadModal');
            
            this.initialize();
        }

        initialize() {
            this.memory.memory.userProfile.usageCount += 1;
            this.memory.memory.userProfile.lastSession = new Date().toISOString();
            this.memory.save();
            
            this.setupEventListeners();
            
            if (this.memory.memory.conversationHistory.length > 0) {
                this.renderConversationHistory();
            }
            
            this.showGreeting();
            
            this.checkAdminStatus();
        }

        setupEventListeners() {
            this.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !this.isProcessing) {
                    this.processUserInput();
                }
            });

            this.sendButton.addEventListener('click', () => {
                if (!this.isProcessing) {
                    this.processUserInput();
                }
            });
            
            document.getElementById('clearChat').addEventListener('click', () => {
                this.showConfirmModal(
                    "Tem certeza que deseja limpar toda a conversa? Esta ação não pode ser desfeita.",
                    () => {
                        this.memory.clearConversation();
                        this.chatMessages.innerHTML = '';
                        this.welcomeMessage.style.display = 'block';
                        this.chatMessages.style.display = 'none';
                        this.showGreeting();
                    }
                );
            });
            
            document.getElementById('showHistory').addEventListener('click', () => {
                this.showHistoryModal();
            });
            
            document.getElementById('showHelp').addEventListener('click', () => {
                this.helpModal.classList.add('active');
            });
            
            document.getElementById('closeModal').addEventListener('click', () => {
                this.confirmModal.classList.remove('active');
            });
            
            document.getElementById('cancelAction').addEventListener('click', () => {
                this.confirmModal.classList.remove('active');
            });
            
            document.getElementById('closeHistoryModal').addEventListener('click', () => {
                this.historyModal.classList.remove('active');
            });
            
            document.getElementById('closeHistoryModalBtn').addEventListener('click', () => {
                this.historyModal.classList.remove('active');
            });
            
            document.getElementById('closeHelpModal').addEventListener('click', () => {
                this.helpModal.classList.remove('active');
            });
            
            document.getElementById('closeHelpModalBtn').addEventListener('click', () => {
                this.helpModal.classList.remove('active');
            });
            
            document.getElementById('closeUploadModal').addEventListener('click', () => {
                this.uploadModal.classList.remove('active');
            });
            
            document.getElementById('cancelUpload').addEventListener('click', () => {
                this.uploadModal.classList.remove('active');
                this.clearFileInput();
            });
            
            document.getElementById('fileInput').addEventListener('change', (e) => {
                this.handleFileUpload(e.target.files);
            });
            
            document.getElementById('confirmUpload').addEventListener('click', () => {
                this.completeFileUpload();
            });
            
            const fileUploadLabel = document.getElementById('fileUploadLabel');
            fileUploadLabel.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadLabel.style.borderColor = '#082945'; 
                fileUploadLabel.style.backgroundColor = '#e6f0ff'; 
            });
            
            fileUploadLabel.addEventListener('dragleave', () => {
                fileUploadLabel.style.borderColor = '#6c757d'; 
                fileUploadLabel.style.backgroundColor = 'transparent';
            });
            
            fileUploadLabel.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadLabel.style.borderColor = '#6c757d'; 
                fileUploadLabel.style.backgroundColor = 'transparent';
                this.handleFileUpload(e.dataTransfer.files);
            });
        }

        checkAdminStatus() {
            const isAdmin = Math.random() > 0.7; 
            this.memory.updateUserProfile({ isAdmin });
            
            if (isAdmin) {
                this.addBotMessage("Modo administrador ativado. Você tem acesso a funções avançadas.");
            }
        }

        showGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'Bom dia';
            
            if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
            else if (hour >= 18) greeting = 'Boa noite';
            
            const userName = this.memory.memory.userProfile.name || 'usuário';
            const isFirstTime = this.memory.memory.userProfile.usageCount === 1;
            
            const greetingMessage = isFirstTime
                ? `${greeting}! Sou seu assistente virtual inteligente. Como posso te ajudar hoje?` 
                : `${greeting}, ${userName}! O que posso fazer por você hoje?`;
            
            this.addBotMessage(greetingMessage);
            
            if (isFirstTime) {
                this.memory.learnPattern('saudacao', 'resposta_personalizada');
            }
        }

        processUserInput() {
            const message = this.chatInput.value.trim();
            if (!message) return;
            
            this.addUserMessage(message);
            this.chatInput.value = '';
            this.isProcessing = true;
            this.sendButton.disabled = true;
            this.showTypingIndicator();
            
            setTimeout(() => {
                try {
                    const currentContext = this.memory.getContext();
                    if (currentContext.flow) {
                        this.continueFlow(message);
                        return;
                    }
                    
                    const learnedResponse = this.memory.getLearnedResponse(message);
                    if (learnedResponse) {
                        this.addBotMessage(learnedResponse);
                        this.isProcessing = false;
                        this.sendButton.disabled = false;
                        this.hideTypingIndicator();
                        return;
                    }
                    
                    this.processMessage(message);
                    
                } catch (error) {
                    console.error("Erro no chatbot:", error);
                    this.addBotMessage("Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.");
                    this.isProcessing = false;
                    this.sendButton.disabled = false;
                    this.hideTypingIndicator();
                }
            }, 600);
        }

        continueFlow(userInput) {
            const result = this.flowSystem.processInput(userInput);
            
            if (result.error) {
                this.addBotMessage(result.error);
            } else {
                this.addBotMessage(result.response);
                
                if (result.actions) {
                    result.actions.forEach(action => {
                        if (action.type === "navigate") {
                            this.addQuickReply(action.label, `window.navigateTo('${action.url}', '${action.label}')`);
                        } else if (action.type === "showUpload") {
                            this.addQuickReply(action.label, `document.getElementById('uploadModal').classList.add('active')`);
                        }
                    });
                }
            }
            
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        processMessage(message) {
            const lowerMsg = message.toLowerCase();
            
            if (/senha|acesso|login|bloqueado|redefinir/.test(lowerMsg)) {
                this.startPasswordResetFlow();
                return;
            }
            
            if (/chamado|problema|reportar|suporte|ajuda/.test(lowerMsg)) {
                this.startTicketCreationFlow();
                return;
            }
            
            if (/perfil|meus dados|atualizar|informações pessoais/.test(lowerMsg)) {
                this.startProfileUpdateFlow();
                return;
            }
            
            if (/admin|relatório|relatorio|painel/.test(lowerMsg) && this.memory.memory.userProfile.isAdmin) {
                this.startAdminReportFlow();
                return;
            }
            
            const response = this.generateResponse(message);
            this.addBotMessage(response.text);
            
            if (response.quickReplies) {
                response.quickReplies.forEach(reply => {
                    this.addQuickReply(reply.text, reply.action);
                });
            }
            
            if (response.learn) {
                this.memory.learnPattern(response.learn.key, response.learn.value);
            }
            
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        startPasswordResetFlow() {
            const firstStep = this.flowSystem.startFlow('PASSWORD_RESET');
            this.addBotMessage(firstStep);
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        startTicketCreationFlow() {
            const firstStep = this.flowSystem.startFlow('TICKET_CREATION');
            this.addBotMessage(firstStep);
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        startProfileUpdateFlow() {
            const firstStep = this.flowSystem.startFlow('PROFILE_UPDATE');
            this.addBotMessage(firstStep);
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        startAdminReportFlow() {
            const firstStep = this.flowSystem.startFlow('ADMIN_REPORT');
            this.addBotMessage(firstStep);
            this.isProcessing = false;
            this.sendButton.disabled = false;
            this.hideTypingIndicator();
        }

        generateResponse(message) {
            const lowerMsg = message.toLowerCase();
            const responses = {
                'saudacao': {
                    text: 'Olá! Como posso te ajudar hoje?',
                    learn: { key: 'saudacao', value: 'resposta_padrao' }
                },
                'ajuda': {
                    text: 'Posso te ajudar com:\n1. Redefinição de senha\n2. Problemas técnicos\n3. Atualização de perfil\n4. Informações sobre o sistema\n\nSobre o que você precisa?',
                    quickReplies: [
                        { text: "Redefinir senha", action: "this.startPasswordResetFlow()" },
                        { text: "Problema técnico", action: "this.startTicketCreationFlow()" }
                    ],
                    learn: { key: 'ajuda', value: 'menu_ajuda' }
                },
                'sistema': {
                    text: 'Para problemas técnicos, recomendo:\n1. Reiniciar o sistema\n2. Limpar cache do navegador\n3. Verificar conexão com a internet\n\nSe o problema persistir, você pode abrir um chamado técnico.',
                    quickReplies: [
                        { text: "Abrir chamado", action: "this.startTicketCreationFlow()" },
                        { text: "Reiniciar sistema", action: "this.addBotMessage('Para reiniciar, vá em Configurações > Sistema > Reiniciar')" }
                    ],
                    learn: { key: 'sistema', value: 'problema_tecnico' }
                },
                'default': {
                    text: 'Entendi sua mensagem. Estou sempre aprendendo para te ajudar melhor! Posso te auxiliar com configurações de conta, problemas técnicos ou informações do sistema. O que você precisa?',
                    quickReplies: [
                        { text: "Ajuda geral", action: "this.generateResponse('ajuda')" },
                        { text: "Falar com humano", action: "this.addBotMessage('Estou transferindo você para um de nossos atendentes. Por favor, aguarde.')" }
                    ],
                    learn: { key: lowerMsg.substring(0, 30), value: 'mensagem_nao_mapeada' }
                }
            };
            
            if (/olá|ola|oi|e aí|bom dia|boa tarde|boa noite/.test(lowerMsg)) return responses['saudacao'];
            if (/ajuda|socorro|suporte|como funciona/.test(lowerMsg)) return responses['ajuda'];
            if (/sistema|lento|travando|erro|bug|não funciona|nao funciona/.test(lowerMsg)) return responses['sistema'];
            
            return responses['default'];
        }

        showConfirmModal(message, confirmCallback) {
            document.getElementById('modalMessage').textContent = message;
            this.confirmModal.classList.add('active');
            
            const confirmAction = document.getElementById('confirmAction');
            confirmAction.onclick = () => {
                confirmCallback();
                this.confirmModal.classList.remove('active');
            };
        }

        showHistoryModal() {
            const tickets = this.memory.getTickets();
            const tableBody = document.getElementById('historyTableBody');
            tableBody.innerHTML = '';
            
            if (tickets.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhum histórico disponível</td></tr>';
            } else {
                tickets.forEach(ticket => {
                    const row = document.createElement('tr');
                    
                    const date = new Date(ticket.createdAt);
                    const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    
                    const statusBadge = ticket.status === 'open' ? 
                        '<span class="badge badge-warning">Aberto</span>' : 
                        '<span class="badge badge-success">Fechado</span>';
                    
                    row.innerHTML = `
                        <td>${dateStr}</td>
                        <td>${ticket.description.substring(0, 30)}${ticket.description.length > 30 ? '...' : ''}</td>
                        <td>${statusBadge}</td>
                        <td class="table-actions">
                            <button class="table-btn table-btn-view" title="Visualizar">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            this.historyModal.classList.add('active');
        }

        handleFileUpload(files) {
            if (!files || files.length === 0) return;
            
            const file = files[0];
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 
                               'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                               'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
            
            if (!validTypes.includes(file.type)) {
                alert('Tipo de arquivo não suportado. Por favor, envie imagens, PDFs ou documentos do Office.');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('O arquivo é muito grande. O tamanho máximo permitido é 5MB.');
                return;
            }
            
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'file-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" class="file-preview-img" alt="Preview">
                        <button class="file-preview-remove" onclick="this.parentNode.remove(); document.getElementById('confirmUpload').disabled = true;">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    preview.appendChild(previewItem);
                    document.getElementById('confirmUpload').disabled = false;
                };
                reader.readAsDataURL(file);
            } else {
                const previewItem = document.createElement('div');
                previewItem.className = 'file-preview-item';
                previewItem.innerHTML = `
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: #f5f7ff;">
                        <i class="fas fa-file" style="font-size: 2rem; color: var(--primary);"></i>
                    </div>
                    <button class="file-preview-remove" onclick="this.parentNode.remove(); document.getElementById('confirmUpload').disabled = true;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                preview.appendChild(previewItem);
                document.getElementById('confirmUpload').disabled = false;
            }
        }

        completeFileUpload() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Por favor, selecione um arquivo antes de enviar.');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const context = this.memory.getContext();
                context.file = {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    data: e.target.result.split(',')[1] 
                };
                
                this.memory.setContext(context);
                this.uploadModal.classList.remove('active');
                this.clearFileInput();
                
                this.addBotMessage("Arquivo recebido com sucesso! Vamos continuar...");
                
                if (context.flow === 'ticket_creation') {
                    const result = this.flowSystem.processInput("arquivo enviado");
                    if (result.error) {
                        this.addBotMessage(result.error);
                    } else {
                        this.addBotMessage(result.response);
                    }
                }
            };
            
            reader.readAsDataURL(file);
        }

        clearFileInput() {
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('confirmUpload').disabled = true;
        }

        addUserMessage(text) {
            this.addMessage('user', text);
            this.memory.addInteraction(text, null);
        }

        addBotMessage(text) {
            this.addMessage('bot', text);
            const lastInteraction = this.memory.memory.conversationHistory
                .filter(i => i.user).slice(-1)[0];
            if (lastInteraction) {
                lastInteraction.bot = text;
                this.memory.save();
            }
        }

        addMessage(sender, text) {
            if (this.memory.memory.conversationHistory.length === 0) {
                this.welcomeMessage.style.display = 'none';
                this.chatMessages.style.display = 'block';
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}-message`;
            messageElement.innerHTML = `
                <div class="message-sender">
                    <i class="fas fa-${sender === 'user' ? 'user' : 'robot'}"></i>
                    ${sender === 'user' ? 'Você' : 'Assistente IA'}
                </div>
                <div class="message-text">${text}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            this.chatMessages.appendChild(messageElement);
            this.scrollToBottom();
        }

        addQuickReply(text, action) {
            const quickReply = document.createElement('button');
            quickReply.className = 'quick-reply';
            quickReply.textContent = text;
            quickReply.onclick = new Function(action);
            
            const quickRepliesContainer = document.createElement('div');
            quickRepliesContainer.className = 'quick-replies';
            quickRepliesContainer.appendChild(quickReply);
            
            this.chatMessages.appendChild(quickRepliesContainer);
            this.scrollToBottom();
        }

        renderConversationHistory() {
            this.welcomeMessage.style.display = 'none';
            this.chatMessages.style.display = 'block';
            
            this.memory.memory.conversationHistory.forEach(interaction => {
                if (interaction.user) {
                    this.addMessage('user', interaction.user);
                }
                if (interaction.bot) {
                    this.addMessage('bot', interaction.bot);
                }
            });
            
            this.scrollToBottom();
        }

        showTypingIndicator() {
            this.typingIndicator.style.display = 'flex';
            this.scrollToBottom();
        }

        hideTypingIndicator() {
            this.typingIndicator.style.display = 'none';
        }

        scrollToBottom() {
            setTimeout(() => {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }, 100);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const chatbot = new IntelligentChatbot();
        
        window.sendQuickMessage = function(message) {
            chatbot.processMessage(message);
        };
        
        window.navigateTo = function(url, label) {
            chatbot.addBotMessage(`Redirecionando para ${label || url}...`);
        };
        
        const style = document.createElement('style');
        style.textContent = `
            .quick-replies {
                display: flex;
                gap: 0.5rem;
                margin: 0.5rem 0;
                flex-wrap: wrap;
            }
            
            .quick-reply {
                background: var(--primary-light);
                border: 1px solid var(--primary);
                color: var(--primary);
                border-radius: 20px;
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                cursor: pointer;
                transition: var(--transition);
                font-weight: 500;
                margin-bottom: 0.5rem;
            }
            
            .quick-reply:hover {
                background: var(--primary);
                color: white;
                transform: translateY(-2px);
            }
        `;
        document.head.appendChild(style);
    });
</script>
</body>
</html>